!function(i){"use strict";Drupal.behaviors.ntb_signup={attach:function(n,t){var s=this;i("body").once("signup-popup",function(){var i=s.getCookie();Drupal.settings.ntb_signup.cookie_length=7,i||setTimeout(function(){s.buildForm(),s.triggerOverlay()},5e3)})},buildForm:function(){var n="";n+='<div class="ntb-signup">',n+='<div class="ntb-signup-overlay"></div>',n+='<div class="ntb-signup-form">',n+='<div class="close"><i class="fa fa-times" aria-hidden="true"></i></div>',n+='<div class="ntb-signup-form-wrapper">',n+='<div class="title">'+Drupal.settings.ntb_signup.premessage+"</div>",n+='<div class="errors"></div>',n+='<div class="input-group">',n+='<input type="email" title="Please, provide an e-mail" placeholder="Email" class="form-control form-text">',n+='<span class="input-group-btn"><button class="btn form-submit button">Submit</button></div>',n+="</div>",n+="</div>",n+="</div>",n+="</div>",i("body").append(n)},triggerOverlay:function(){i(".ntb-signup").fadeIn(),i(".ntb-signup input").focus(),i(".ntb-signup .btn").on("click",Drupal.behaviors.ntb_signup.submit),i(".ntb-signup .close").on("click",Drupal.behaviors.ntb_signup.close),i(".ntb-signup-overlay").on("click",Drupal.behaviors.ntb_signup.close)},validateEmail:function(i){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(i)},submit:function(){var n=i(".ntb-signup input").val(),t=Drupal.behaviors.ntb_signup.validateEmail(n);return t?void i.ajax({type:"POST",dataType:"json",url:"/signup/ajax/submit/",data:{email:n}}).done(function(i){Drupal.behaviors.ntb_signup.submit_response(i)}).fail(function(){i(".ntb-signup .errors").html(Drupal.t("We're sorry. We were unable to process your email"))}):void i(".ntb-signup .errors").html(Drupal.t("That is not a valid email address."))},close:function(){i(".ntb-signup").fadeOut(),Drupal.behaviors.ntb_signup.setCookie()},submit_response:function(n){var t="";"23000"===n?t=Drupal.settings.ntb_signup.alreadymessage:"success"===n&&(t=Drupal.settings.ntb_signup.postmessage);var s=i(".ntb-signup-form-wrapper");s.fadeOut(function(){i(this).html(t)}).fadeIn(),Drupal.settings.ntb_signup.cookie_length=3650},getCookie:function(){var i=new RegExp("(?:(?:^|.*;\\s*)"+Drupal.settings.ntb_signup.cookie+"\\s*\\=\\s*([^;]*).*$)|^.*$");return document.cookie.replace(i,"$1")},setCookie:function(){var i=Drupal.settings.ntb_signup.cookie,n=1,t=Drupal.settings.ntb_signup.cookie_length,s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3);var e="expires="+s.toUTCString();document.cookie=i+"="+n+"; "+e}}}(jQuery);
