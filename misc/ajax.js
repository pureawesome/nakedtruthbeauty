!function($){Drupal.ajax=Drupal.ajax||{},Drupal.settings.urlIsAjaxTrusted=Drupal.settings.urlIsAjaxTrusted||{},Drupal.behaviors.AJAX={attach:function(e,t){for(var s in t.ajax)if(!$("#"+s+".ajax-processed").length){var r=t.ajax[s];"undefined"==typeof r.selector&&(r.selector="#"+s),$(r.selector).each(function(){r.element=this,Drupal.ajax[s]=new Drupal.ajax(s,this,r)}),$("#"+s).addClass("ajax-processed")}$(".use-ajax:not(.ajax-processed)").addClass("ajax-processed").each(function(){var e={};e.progress={type:"throbber"},$(this).attr("href")&&(e.url=$(this).attr("href"),e.event="click");var t=$(this).attr("id");Drupal.ajax[t]=new Drupal.ajax(t,this,e)}),$(".use-ajax-submit:not(.ajax-processed)").addClass("ajax-processed").each(function(){var e={};e.url=$(this.form).attr("action"),e.setClick=!0,e.event="click",e.progress={type:"throbber"};var t=$(this).attr("id");Drupal.ajax[t]=new Drupal.ajax(t,this,e)})}},Drupal.ajax=function(e,t,s){var r={url:"system/ajax",event:"mousedown",keypress:!0,selector:"#"+e,effect:"none",speed:"none",method:"replaceWith",progress:{type:"throbber",message:Drupal.t("Please wait...")},submit:{js:!0}};$.extend(this,r,s),this.element=t,this.element_settings=s,this.url=s.url.replace(/\/nojs(\/|$|\?|&|#)/g,"/ajax$1"),Drupal.settings.urlIsAjaxTrusted[s.url]&&(Drupal.settings.urlIsAjaxTrusted[this.url]=!0),this.wrapper="#"+s.wrapper,this.element.form&&(this.form=$(this.element.form));var a=this;a.options={url:a.url,data:a.submit,beforeSerialize:function(e,t){return a.beforeSerialize(e,t)},beforeSubmit:function(e,t,s){return a.ajaxing=!0,a.beforeSubmit(e,t,s)},beforeSend:function(e,t){return a.ajaxing=!0,a.beforeSend(e,t)},success:function(e,t,s){if("string"==typeof e&&(e=$.parseJSON(e)),null!==e&&!Drupal.settings.urlIsAjaxTrusted[a.url]&&"1"!==s.getResponseHeader("X-Drupal-Ajax-Token")){var r=Drupal.t("The response failed verification so will not be processed.");return a.error(s,a.url,r)}return a.success(e,t)},complete:function(e,t){if(a.ajaxing=!1,"error"==t||"parsererror"==t)return a.error(e,a.url)},dataType:"json",type:"POST"},$(a.element).bind(s.event,function(e){if(!Drupal.settings.urlIsAjaxTrusted[a.url]&&!Drupal.urlIsLocal(a.url))throw new Error(Drupal.t("The callback URL is not local and not trusted: !url",{"!url":a.url}));return a.eventResponse(this,e)}),s.keypress&&$(a.element).keypress(function(e){return a.keypressResponse(this,e)}),s.prevent&&$(a.element).bind(s.prevent,!1)},Drupal.ajax.prototype.keypressResponse=function(e,t){var s=this;if(13==t.which||32==t.which&&"text"!=e.type&&"textarea"!=e.type)return $(s.element_settings.element).trigger(s.element_settings.event),!1},Drupal.ajax.prototype.eventResponse=function(e,t){var s=this;if(s.ajaxing)return!1;try{s.form?(s.setClick&&(e.form.clk=e),s.form.ajaxSubmit(s.options)):(s.beforeSerialize(s.element,s.options),$.ajax(s.options))}catch(e){s.ajaxing=!1,alert("An error occurred while attempting to process "+s.options.url+": "+e.message)}return"undefined"!=typeof e.type&&("checkbox"==e.type||"radio"==e.type)},Drupal.ajax.prototype.beforeSerialize=function(e,t){if(this.form){var s=this.settings||Drupal.settings;Drupal.detachBehaviors(this.form,s,"serialize")}t.data["ajax_html_ids[]"]=[],$("[id]").each(function(){t.data["ajax_html_ids[]"].push(this.id)}),t.data["ajax_page_state[theme]"]=Drupal.settings.ajaxPageState.theme,t.data["ajax_page_state[theme_token]"]=Drupal.settings.ajaxPageState.theme_token;for(var r in Drupal.settings.ajaxPageState.css)t.data["ajax_page_state[css]["+r+"]"]=1;for(var r in Drupal.settings.ajaxPageState.js)t.data["ajax_page_state[js]["+r+"]"]=1},Drupal.ajax.prototype.beforeSubmit=function(e,t,s){},Drupal.ajax.prototype.beforeSend=function(xmlhttprequest,options){if(this.form){options.extraData=options.extraData||{},options.extraData.ajax_iframe_upload="1";var v=$.fieldValue(this.element);null!==v&&(options.extraData[this.element.name]=Drupal.checkPlain(v))}if($(this.element).addClass("progress-disabled").attr("disabled",!0),"bar"==this.progress.type){var progressBar=new Drupal.progressBar("ajax-progress-"+this.element.id,eval(this.progress.update_callback),this.progress.method,eval(this.progress.error_callback));this.progress.message&&progressBar.setProgress(-1,this.progress.message),this.progress.url&&progressBar.startMonitoring(this.progress.url,this.progress.interval||1500),this.progress.element=$(progressBar.element).addClass("ajax-progress ajax-progress-bar"),this.progress.object=progressBar,$(this.element).after(this.progress.element)}else"throbber"==this.progress.type&&(this.progress.element=$('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>'),this.progress.message&&$(".throbber",this.progress.element).after('<div class="message">'+this.progress.message+"</div>"),$(this.element).after(this.progress.element))},Drupal.ajax.prototype.success=function(e,t){this.progress.element&&$(this.progress.element).remove(),this.progress.object&&this.progress.object.stopMonitoring(),$(this.element).removeClass("progress-disabled").removeAttr("disabled"),Drupal.freezeHeight();for(var s in e)e.hasOwnProperty(s)&&e[s].command&&this.commands[e[s].command]&&this.commands[e[s].command](this,e[s],t);if(this.form){var r=this.settings||Drupal.settings;Drupal.attachBehaviors(this.form,r)}Drupal.unfreezeHeight(),this.settings=null},Drupal.ajax.prototype.getEffect=function(e){var t=e.effect||this.effect,s=e.speed||this.speed,r={};return"none"==t?(r.showEffect="show",r.hideEffect="hide",r.showSpeed=""):"fade"==t?(r.showEffect="fadeIn",r.hideEffect="fadeOut",r.showSpeed=s):(r.showEffect=t+"Toggle",r.hideEffect=t+"Toggle",r.showSpeed=s),r},Drupal.ajax.prototype.error=function(e,t,s){if(Drupal.displayAjaxError(Drupal.ajaxError(e,t,s)),this.progress.element&&$(this.progress.element).remove(),this.progress.object&&this.progress.object.stopMonitoring(),$(this.wrapper).show(),$(this.element).removeClass("progress-disabled").removeAttr("disabled"),this.form){var r=this.settings||Drupal.settings;Drupal.attachBehaviors(this.form,r)}},Drupal.ajax.prototype.commands={insert:function(e,t,s){var r=$(t.selector?t.selector:e.wrapper),a=t.method||e.method,o=e.getEffect(t),i=$("<div></div>").html(t.data),n=i.contents();switch(1==n.length&&1==n.get(0).nodeType||(n=i),a){case"html":case"replaceWith":case"replaceAll":case"empty":case"remove":var l=t.settings||e.settings||Drupal.settings;Drupal.detachBehaviors(r,l)}if(r[a](n),"show"!=o.showEffect&&n.hide(),$(".ajax-new-content",n).length>0?($(".ajax-new-content",n).hide(),n.show(),$(".ajax-new-content",n)[o.showEffect](o.showSpeed)):"show"!=o.showEffect&&n[o.showEffect](o.showSpeed),n.parents("html").length>0){var l=t.settings||e.settings||Drupal.settings;Drupal.attachBehaviors(n,l)}},remove:function(e,t,s){var r=t.settings||e.settings||Drupal.settings;Drupal.detachBehaviors($(t.selector),r),$(t.selector).remove()},changed:function(e,t,s){$(t.selector).hasClass("ajax-changed")||($(t.selector).addClass("ajax-changed"),t.asterisk&&$(t.selector).find(t.asterisk).append(' <span class="ajax-changed">*</span> '))},alert:function(e,t,s){alert(t.text,t.title)},css:function(e,t,s){$(t.selector).css(t.argument)},settings:function(e,t,s){t.merge?$.extend(!0,Drupal.settings,t.settings):e.settings=t.settings},data:function(e,t,s){$(t.selector).data(t.name,t.value)},invoke:function(e,t,s){var r=$(t.selector);r[t.method].apply(r,t.arguments)},restripe:function(e,t,s){$("> tbody > tr:visible, > tr:visible",$(t.selector)).removeClass("odd even").filter(":even").addClass("odd").end().filter(":odd").addClass("even")},add_css:function(e,t,s){$("head").prepend(t.data);var r,a=/^@import url\("(.*)"\);$/gim;if(document.styleSheets[0].addImport&&a.test(t.data))for(a.lastIndex=0;r=a.exec(t.data);)document.styleSheets[0].addImport(r[1])},updateBuildId:function(e,t,s){$('input[name="form_build_id"][value="'+t.old+'"]').val(t.new)}}}(jQuery);
